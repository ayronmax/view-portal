CREATE OR REPLACE PROCEDURE SP_SOL_DELETA_PEDIDO_ITEM
(IN NREMP SMALLINT,
IN PRE_PED DECIMAL(12,0),
IN ITEM SMALLINT,
IN PROD INTEGER,
OUT COD_ERRO SMALLINT,
OUT MSG_ERRO VARCHAR(100))

LANGUAGE SQL

BEGIN

IF NREMP IS NOT NULL AND PRE_PED IS NOT NULL AND ITEM IS NOT NULL THEN
   DECLARE strUser VARCHAR(20);
   DECLARE strSql VARCHAR(5000);
   DECLARE strDataProc VARCHAR(10);
   DECLARE strHoraProc VARCHAR(8);

   SET strUser = SELECT TRIM(CURRENT_USER);
   SET strDataProc = REPLACE(CAST(CURDATE() AS VARCHAR(10)), '-', '');
   SET strHoraProc = LEFT(REPLACE(CAST(CURTIME() AS VARCHAR(8)), ':', ''), 4);
   
   SET strSql = 'DELETE FROM ' || strUser || '.VDPEDIPP WHERE VDPEDIPP_NREMP = ' || CAST(NREMP AS VARCHAR(20))
	|| ' AND VDPEDIPP_PRE_PED = ' || CAST(PRE_PED AS VARCHAR(20)) || ' AND VDPEDIPP_ITEM' || CAST(ITEM AS VARCHAR(20))
	|| ' AND VDPEDIPP_PROD = ' || CAST(PROD AS VARCHAR(20)) || ';';
   EXECUTE IMMEDIATE strSql;
	
   SET COD_ERRO = 0;
   SET MSG_ERRO = 'registro iserido com sucesso!';

ELSE
	SET COD_ERRO = 1;
	SET MSG_ERRO = 'NREMP, PRE_PED e ITEM  nao podem ser nulos!';
END IF;
END;

